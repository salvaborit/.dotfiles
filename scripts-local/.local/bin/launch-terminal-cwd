#!/bin/bash
# Return the current working directory of the active terminal
# Falls back to $HOME if unable to determine CWD

# Get PID of active window
terminal_pid=$(hyprctl activewindow -j | jq -r '.pid' 2>/dev/null)

if [[ -n $terminal_pid ]]; then
  # Get shell child process of terminal
  shell_pid=$(pgrep -P "$terminal_pid" | tail -n1)

  if [[ -n $shell_pid ]]; then
    # Read cwd symlink
    cwd=$(readlink -f "/proc/$shell_pid/cwd" 2>/dev/null)

    if [[ -d $cwd ]]; then
      echo "$cwd"
      exit 0
    fi
  fi
fi

# Fallback to home
echo "$HOME"
